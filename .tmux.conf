unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

bind r source-file ~/.tmux.conf \; display "Reloaded!"

set-option -g history-limit 5000

# # #
# # # General Settings
# # #
# Change base panels 
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g set-clipboard on

# Keybindings
# Popups
bind C-t display-popup -d "#{pane_current_path}" -E "zsh"
bind C-y display-popup -d "#{pane-current_path}" -w 80% -h 80% -E "lazygit"
bind C-p display-popup -E "tmux list-panes -a -F '#{session_name}: #{pane_current_command}' | grep -v \"^$(tmux display-message -p '#S:#I.#{pane_index}')\" | fzf --reverse | awk -F: '{print \$1\":\"\$2}' | xargs tmux switch-client -t"
bind C-g display-popup -E "bash -i ~/.tmux/scripts/gemini.sh"
bind C-x display-popup -E "nvim ~/Documents/notes.txt"
# Toggleable persistent popup for codex cli
# Name of your persistent session
SESSION_NAME="codex-cli-popup"

# Keybinding for the toggle (e.g., Prefix + C-c)
bind-key C-c run-shell 'if [ "$(tmux display-message -p -F "#{session_name}")" = "$SESSION_NAME" ]; then \
    tmux detach-client; \
else \
    if tmux has-session -t "$SESSION_NAME" 2>/dev/null; then \
        tmux display-popup -w 80% -h 80% -xC -yC -E "tmux attach -t $SESSION_NAME"; \
    else \
        tmux display-popup -w 80% -h 80% -xC -yC -E "tmux new-session -d -s $SESSION_NAME \"codex cli\"; tmux attach -t $SESSION_NAME"; \
    fi; \
fi'  

# Switch to marked pane
bind a select-pane -m

# Horizontal split with 'd' key
bind - split-window -h

# Vertical split with 'f' key
bind | split-window -v

# Swap windows
bind -r C-z swap-window -d -t -1
bind -r C-x swap-window -d -t +1

# Toggle last pane
bind Space last-window

# Toggle session
bind-key C-a switch-client -l

#¬†Resizing
bind -r C-j resize-pane -D 15
bind -r C-k resize-pane -U 15
bind -r C-h resize-pane -L 15
bind -r C-l resize-pane -R 15

# Navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

set -g mouse on 
set-window-option -g mode-keys vi

set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-sensible' # optional recommended

set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'

# General statusline customisation
set -g status-style 'bg=terminal'

# Theme
## Configure the catppuccin plugin <https://github.com/catppuccin/tmux>
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavor 'macchiato' # latte, frappe, macchiato, mocha

# status left style
set -g status-left-length 100
set -g status-left ""
set -ga status-left "#{?client_prefix,#{#[bg=#{@thm_red},fg=#{@thm_mantle},bold] ÓØà #S },#{#[bg=#{@thm_mantle},fg=#{@thm_green}] ÓØà #S }}"
set -ga status-left "#[bg=#{@thm_mantle},fg=#{@thm_overlay_0},none]‚îÇ"
set -ga status-left "#[bg=#{@thm_mantle},fg=#{@thm_maroon}] Ó™Ö #{pane_current_command} "
set -ga status-left "#[bg=#{@thm_mantle},fg=#{@thm_overlay_0},none]‚îÇ"
set -ga status-left "#[bg=#{@thm_mantle},fg=#{@thm_blue}] Ó´∑ #{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}} "

# Aerospace indicator
set -ga status-left "#[bg=#{@thm_mantle},fg=#{@thm_yellow}] Ó¨£ #(f=\$(aerospace list-workspaces --focused); aerospace list-workspaces --monitor all --visible | tail -r | awk -v focused=\"\$f\" '{ val = (\$1 == focused) ? \"*\"\$1 : \$1; printf (NR==1 ? \"(\"val : \" | \"val) } END { printf \")\" }') "

# set -g status-justify "left"
set-option -g status-position top

# status right style
set -g status-right-length 100
set -g status-right ""

# Llama.cpp server status
set -ga status-right "#[bg=#{@thm_mantle}]#{?#(pgrep llama-server >/dev/null 2>&1 && echo 1 || echo 0),#[fg=#{@thm_yellow}] ü¶ô on ,#[fg=#{@thm_overlay_0}] ü¶ô off }"
set -ga status-right "#[bg=#{@thm_mantle},fg=#{@thm_overlay_0}, none]‚îÇ"

# Docker indicator
set -ga status-right "#[bg=#{@thm_mantle}]#{?#(docker info >/dev/null 2>&1 && echo 1 || echo 0),#[fg=#{@thm_blue}] Ôåà  on ,#[fg=#{@thm_red}] Ôåà  off }"
set -ga status-right "#[bg=#{@thm_mantle},fg=#{@thm_overlay_0}, none]‚îÇ"

# Other indicators
set -ga status-right "#{?#{e|>=:10,#{battery_percentage}},#{#[bg=#{@thm_red},fg=#{@thm_mantle}]},#{#[bg=#{@thm_mantle},fg=#{@thm_pink}]}} #{battery_icon} #{battery_percentage} "
set -ga status-right "#[bg=#{@thm_mantle},fg=#{@thm_overlay_0}, none]‚îÇ"
set -ga status-right "#[bg=#{@thm_mantle}]#{?#{==:#{online_status},ok},#[fg=#{@thm_mauve}] Û∞ñ© on ,#[fg=#{@thm_red},bold]#[reverse] Û∞ñ™ off }"
set -ga status-right "#[bg=#{@thm_mantle},fg=#{@thm_overlay_0}, none]‚îÇ"
set -ga status-right "#[bg=#{@thm_mantle},fg=#{@thm_blue}] Û∞≠¶ %Y-%m-%d Û∞Öê %H:%M "

# window style
set -wg automatic-rename on
set -g automatic-rename-format ''
set -g window-status-separator '|'
set -g status-justify 'absolute-centre'
set -g @catppuccin_window_status_style 'custom'
set -g @catppuccin_window_flags ""
set -g @catppuccin_window_number ""
set -g @catppuccin_window_text "#[fg=#{@thm_rosewater},bg=#{@thm_mantle}] #I#{?#{!=:#{window_name},},: #W ,}"
set -g @catppuccin_window_current_number ""
set -g @catppuccin_window_current_text "#[fg=#{@thm_mantle},bg=#{@thm_peach}] #I#{?#{!=:#{window_name},},: #W ,}"

# Configure Online
set -g @online_icon "ok"
set -g @offline_icon "nok"

# Initialize tmux plugin manager. keep this at the end of the file
run '~/.tmux/plugins/tpm/tpm'
